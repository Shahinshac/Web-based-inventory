{% extends "base.html" %}

{% block title %}Invoices{% endblock %}

{% block content %}
<h1 style="color: #ffffff; margin-bottom: 24px; font-size: 1.75rem;">
    <i class="fas fa-file-invoice"></i> Invoices
</h1>

<div class="card">
    <!-- Search and Filter -->
    <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
        <form action="{{ url_for('invoices') }}" method="GET" style="flex: 1; display: flex; gap: 12px;">
            <input type="text" name="search" class="form-control" placeholder="ðŸ” Search invoice or customer..." value="{{ search }}" style="flex: 1;">
            <input type="hidden" name="date_filter" value="{{ date_filter }}">
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
    
    <!-- Date Filter Tabs -->
    <div class="filter-tabs">
        <a href="{{ url_for('invoices', date_filter='all') }}" class="filter-tab {% if date_filter == 'all' %}active{% endif %}">All Time</a>
        <a href="{{ url_for('invoices', date_filter='today') }}" class="filter-tab {% if date_filter == 'today' %}active{% endif %}">Today</a>
        <a href="{{ url_for('invoices', date_filter='week') }}" class="filter-tab {% if date_filter == 'week' %}active{% endif %}">This Week</a>
        <a href="{{ url_for('invoices', date_filter='month') }}" class="filter-tab {% if date_filter == 'month' %}active{% endif %}">This Month</a>
    </div>
    
    <!-- Invoices Table -->
    {% if invoices %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Invoice #</th>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Items</th>
                    <th>Subtotal</th>
                    <th>GST</th>
                    <th>Total</th>
                    <th>Payment</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                <tr>
                    <td>
                        <a href="{{ url_for('view_invoice', id=invoice.id) }}" style="color: #4f46e5; font-weight: 600;">
                            {{ invoice.bill_number }}
                        </a>
                    </td>
                    <td style="font-size: 0.85rem; color: #64748b;">{{ invoice.bill_date[:16] }}</td>
                    <td style="font-weight: 500;">{{ invoice.customer_name }}</td>
                    <td>{{ invoice.item_count }}</td>
                    <td>â‚¹{{ "{:,.0f}".format(invoice.subtotal) }}</td>
                    <td style="color: #64748b;">â‚¹{{ "{:,.0f}".format(invoice.gst_amount) }}</td>
                    <td style="font-weight: 700; color: #10b981;">â‚¹{{ "{:,.0f}".format(invoice.grand_total) }}</td>
                    <td>
                        <span class="badge badge-{% if invoice.payment_mode == 'cash' %}success{% elif invoice.payment_mode == 'upi' %}info{% else %}warning{% endif %}">
                            {{ invoice.payment_mode|upper }}
                        </span>
                    </td>
                    <td>
                        <a href="{{ url_for('view_invoice', id=invoice.id) }}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-eye"></i> View
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-receipt"></i>
        <h3>No invoices found</h3>
        <p>{% if search or date_filter != 'all' %}Try changing filters{% else %}Complete a sale to generate invoices{% endif %}</p>
    </div>
    {% endif %}
</div>
{% endblock %}
